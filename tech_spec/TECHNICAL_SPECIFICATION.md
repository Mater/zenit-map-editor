# Zenit Map Editor - Техническая спецификация

## Общая информация

**Название проекта:** Zenit Map Editor  
**Версия:** 1.0.0  
**Технологический стек:** Electron, electron-vite, React, TypeScript, Tailwind CSS, React Context API, ESLint, Prettier  
**Целевая платформа:** Desktop (Windows, macOS, Linux)  
**Язык интерфейса:** Русский

## Описание проекта

Desktop приложение для редактирования топливных карт газобаллонного оборудования Zenit JZ 2009. Позволяет загружать, просматривать и объединять топливные карты в формате \*.map.

## Функциональные требования

### 1. Загрузка и управление файлами

- **Загрузка файлов:** Кнопка "Выбрать файлы" и Drag & Drop поддержка
- **Множественный выбор:** Загрузка нескольких \*.map файлов одновременно
- **Валидация:** Проверка формата файлов (480 строк, числовые данные)
- **Управление видимостью:** Включение/отключение файлов и отдельных карт (бензин/газ)

### 2. Визуализация карт

- **Координатная сетка:** X - давление (мбар), Y - время впрыска (мс)
- **Цветовое кодирование:** Бензиновые точки (синий), газовые точки (желтый)
- **Масштабирование:** Автоматическое для отображения всех 120 точек
- **Активный файл:** Полная непрозрачность, неактивные - 50%

### 3. Объединение карт

- **Выбор карт:** Радио-кнопки для выбора одной бензиновой и одной газовой карты
- **Сохранение:** Создание итогового файла с именем по умолчанию
- **Формат:** \*.map файл с объединенными данными

## Технические требования

### 1. Архитектура приложения

**Структура проекта:**

```
src/
├── main/                # Electron главный процесс
│   ├── index.ts         # Точка входа
│   └── preload.ts       # Preload скрипт
├── renderer/            # React приложение
│   ├── components/      # React компоненты
│   ├── hooks/           # React хуки
│   ├── services/        # Бизнес-логика
│   ├── context/         # React Context для состояния
│   └── types/           # TypeScript типы
└── shared/              # Общий код
```

**Основные модули:**

- **FileManager:** Управление файлами
- **MapViewer:** Canvas визуализация
- **ControlPanel:** Панель управления
- **FileService:** Парсинг \*.map файлов
- **MapService:** Обработка карт

### 2. Формат файлов \*.map

**Структура данных:**

- Файлы содержат 480 строк (120 точек × 4 значения)
- Каждая точка: X*бензин, Y*бензин, X*газ, Y*газ
- X - давление в коллекторе (мбар), Y - время впрыска (мс)

**Объединение карт:**

- Выбор одной бензиновой и одной газовой карты
- Создание нового файла с объединенными данными
- Формат: [X1_бенз, Y1_бенз, X1_газ, Y1_газ, ...]

### 3. Пользовательский интерфейс

**Макет:**

```
┌─────────────────────────────────────────────────────────────────────────────┐
│ Zenit Map Editor                                                            │
├─────────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────┐ ┌─────────────────────────────────────────┐ │
│ │                             │ │ [Выбрать файлы]                         │ │
│ │                             │ ├─────────────────────────────────────────┤ │
│ │        ГРАФИК               │ │ Загруженные файлы:                      │ │
│ │     (Canvas область)        │ │ [Включить все] [Отключить все]          │ │
│ │                             │ │                                         │ │
│ │  ┌─────────────────────┐    │ │ ┌─────────────────────────────────────┐ │ │
│ │  │                     │    │ │ │ ☑ 31102018.map                      │ │ │
│ │  │   Топливные точки   │    │ │ │   ┌─ ☑ Бензин: ○                    │ │ │
│ │  │   • • • • • • •     │    │ │ │   └─ ☑ Газ: ○                       │ │ │
│ │  │   • • • • • • •     │    │ │ │                                     │ │ │
│ │  │   • • • • • • •     │    │ │ │ ☑ 15112018.map                      │ │ │
│ │  │   • • • • • • •     │    │ │ │   ┌─ ☑ Бензин: ○                    │ │ │
│ │  │                     │    │ │ │   └─ ☑ Газ: ○                       │ │ │
│ │  └─────────────────────┘    │ │ │                                     │ │ │
│ │                             │ │ │ ☐ 20122018.map                      │ │ │
│ │  X: Давление (мбар)         │ │ │   ┌─ ☑ Бензин: ○                    │ │ │
│ │  Y: Время впрыска (мс)      │ │ │   └─ ☑ Газ: ○                       │ │ │
│ │                             │ │ │                                     │ │ │
│ │                             │ │ │ ☐ 05012019.map                      │ │ │
│ │                             │ │ │   ┌─ ☑ Бензин: ○                    │ │ │
│ │                             │ │ │   └─ ☑ Газ: ○                       │ │ │
│ │                             │ │ │                                     │ │ │
│ │                             │ │ │ ...                                 │ │ │
│ │                             │ │ └─────────────────────────────────────┘ │ │
│ │                             │ │                                         │ │
│ │                             │ │ [Сохранить] Имя: [бензиновая карта.map] │ │
│ │                             │ │                                         │ │
│ └─────────────────────────────┘ └─────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────────┘
```

- Двухколоночный: график слева, панель управления справа
- Canvas область для визуализации карт
- Список загруженных файлов с управлением

**Стили (Tailwind CSS):**

- Бензиновые точки: синий цвет
- Газовые точки: желтый цвет
- Современный UI с hover/focus состояниями

### 4. Основные сервисы

**FileService:**

- Парсинг и валидация \*.map файлов
- Извлечение бензиновых и газовых карт
- Объединение карт для сохранения

**MapService:**

- Canvas рендеринг карт
- Координатная система и масштабирование
- Обработка взаимодействий

**AppContext (React Context):**

- Управление состоянием файлов
- Выбор карт для объединения
- UI состояние приложения
- Централизованное управление состоянием без внешних библиотек

**Структура Context:**

```typescript
interface AppState {
  files: MapFile[];
  selectedGasolineMap: string | null;
  selectedGasMap: string | null;
  isLoading: boolean;
  error: string | null;
}

interface AppActions {
  loadFiles: (files: File[]) => Promise<void>;
  toggleFileVisibility: (fileId: string) => void;
  toggleMapVisibility: (fileId: string, mapType: 'gasoline' | 'gas') => void;
  selectMap: (fileId: string, mapType: 'gasoline' | 'gas') => void;
  saveMergedMap: (filename: string) => Promise<void>;
}
```

## Нефункциональные требования

**Производительность:**

- Время загрузки: < 3 секунд для файлов до 10MB
- Отзывчивость UI: < 100ms для переключения между картами

**Совместимость:**

- Windows 10+, macOS 10.15+, Linux Ubuntu 18.04+

**Безопасность:**

- Валидация файлов и обработка ошибок
- Sandbox режим Electron

## Структура проекта

**Основные директории:**

```
src/
├── main/                # Electron главный процесс
│   ├── index.ts         # Точка входа
│   └── preload.ts       # Preload скрипт
├── renderer/            # React приложение
│   ├── components/      # React компоненты
│   ├── hooks/           # React хуки
│   ├── services/        # Бизнес-логика
│   ├── context/         # React Context для состояния
│   └── types/           # TypeScript типы
└── shared/              # Общий код
```

**Конфигурация:**

- TypeScript, ESLint, Prettier
- Tailwind CSS для стилей
- electron-vite для сборки и разработки
- Electron Builder для финальной сборки приложения

## План разработки

### Этап 1: Базовая структура

- Настройка electron-vite + React + TypeScript проекта
- Конфигурация Tailwind CSS, ESLint, Prettier
- Создание базовой структуры и React Context

### Этап 2: UI компоненты

- Создание базовых UI компонентов
- Реализация FileManager и MapViewer
- Интеграция с Electron API

### Этап 3: Бизнес-логика

- Реализация FileService и MapService
- Валидация файлов и алгоритм объединения
- Система выбора карт

### Этап 4: Тестирование

- Unit и E2E тесты
- Оптимизация производительности
- Сборка для всех платформ

## Технологический стек

**Основные технологии:**

- **Electron** - Desktop приложение
- **electron-vite** - Сборщик и инструменты разработки
- **React 19** - UI библиотека
- **TypeScript** - Статическая типизация
- **Tailwind CSS** - Utility-first CSS
- **React Context API** - Управление состоянием

**Инструменты разработки:**

- **ESLint + Prettier** - Качество кода
- **Jest + React Testing Library** - Тестирование
- **Playwright** - E2E тестирование
- **Electron Builder** - Сборка приложения

## Текущий статус проекта

**В процессе:**

- Настройка electron-vite технологического стека
- Создание базовой архитектуры с React Context

**Планируется:**

- Реализация React компонентов
- Интеграция с Electron API
- Тестирование и оптимизация

## Критерии приемки

**Функциональные:**

- Загрузка и валидация \*.map файлов
- Визуализация карт с координатной сеткой
- Управление видимостью файлов и карт
- Выбор карт для объединения
- Сохранение объединенных файлов

**Технические:**

- Стабильная работа на всех платформах
- Обработка ошибок
- Производительность согласно требованиям

## Дополнительные возможности

**v1.1:**

- Предварительный просмотр объединенной карты
- Настройки цветов и прозрачности

**v1.2:**

- Редактирование топливных точек
- Создание новых карт

**v1.3:**

- Сравнение карт
- Пакетная обработка файлов

---

**Версия документа:** 1.0  
**Автор:** Yury Marmysh
