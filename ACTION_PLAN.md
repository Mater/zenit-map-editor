# Zenit Map Editor - План действий

## Обзор проекта

Desktop приложение для редактирования топливных карт газобаллонного оборудования Zenit JZ 2009.

## Технологический стек

- **Electron** - Desktop приложение
- **electron-vite** - Сборщик и инструменты разработки
- **React 19** - UI библиотека
- **TypeScript** - Статическая типизация
- **Tailwind CSS** - Utility-first CSS
- **React Context API** - Управление состоянием (вместо zustand)

## Этапы разработки

### Этап 1: Настройка проекта (1-2 дня) ✅

- [x] Инициализация проекта с electron-vite react-ts template
- [x] Настройка TypeScript конфигурации
- [x] Настройка Tailwind CSS
- [x] Настройка ESLint и Prettier
- [x] Создание базовой структуры папок
- [x] Настройка скриптов сборки и разработки

### Этап 2: Базовая архитектура (2-3 дня) ✅

- [x] Создание React Context для управления состоянием
- [x] Определение TypeScript типов для карт и файлов
- [x] Создание базовых сервисов (FileService, MapService)
- [x] Настройка Electron IPC коммуникации
- [x] Создание базовых хуков (useFiles, useMaps)

### Этап 3: UI компоненты (3-4 дня)

- [x] Создание компонента FileManager
  - [x] Drag & Drop загрузка файлов
  - [x] Список загруженных файлов
  - [x] Управление видимостью файлов и карт
- [x] Создание компонента MapViewer
  - [x] Canvas для отображения карт
  - [x] Координатная сетка
  - [x] Цветовое кодирование точек
- [x] Создание компонента ControlPanel
  - [x] Кнопки управления
  - [x] Выбор карт для объединения
  - [x] Поле ввода имени файла

### Этап 4: Бизнес-логика (2-3 дня)

- [ ] Реализация парсинга .map файлов
- [ ] Валидация формата файлов (480 строк)
- [ ] Алгоритм объединения карт
- [ ] Система выбора бензиновых и газовых карт
- [ ] Сохранение объединенных файлов

### Этап 5: Интеграция и тестирование (2-3 дня)

- [ ] Интеграция всех компонентов
- [ ] Тестирование с реальными .map файлами
- [ ] Обработка ошибок и edge cases
- [ ] Оптимизация производительности
- [ ] Тестирование на разных платформах

### Этап 6: Финальная сборка (1 день)

- [ ] Настройка Electron Builder
- [ ] Создание инсталляторов для Windows, macOS, Linux
- [ ] Тестирование финальных сборок
- [ ] Подготовка релиза

## Детальные задачи

### Настройка проекта

```bash
# Создание проекта
npm create electron-vite@latest zenit-map-editor -- --template react-ts

# Установка зависимостей
npm install tailwindcss @tailwindcss/forms
npm install -D @types/node

# Настройка Tailwind
npx tailwindcss init -p
```

### Структура файлов

```
src/
├── main/                    # Electron главный процесс
│   ├── index.ts            # Точка входа
│   └── preload.ts          # Preload скрипт
├── renderer/               # React приложение
│   ├── components/         # React компоненты
│   │   ├── FileManager.tsx
│   │   ├── MapViewer.tsx
│   │   └── ControlPanel.tsx
│   ├── hooks/              # React хуки
│   │   ├── useFiles.ts
│   │   └── useMaps.ts
│   ├── services/           # Бизнес-логика
│   │   ├── FileService.ts
│   │   └── MapService.ts
│   ├── context/            # React Context
│   │   └── AppContext.tsx
│   ├── types/              # TypeScript типы
│   │   └── index.ts
│   ├── App.tsx
│   └── main.tsx
└── shared/                 # Общий код
    └── types.ts
```

### Ключевые типы данных

```typescript
interface MapPoint {
  x: number; // давление (мбар)
  y: number; // время впрыска (мс)
}

interface FuelMap {
  gasoline: MapPoint[];
  gas: MapPoint[];
}

interface MapFile {
  id: string;
  name: string;
  path: string;
  data: FuelMap;
  visible: boolean;
  gasolineVisible: boolean;
  gasVisible: boolean;
}
```

### Основные сервисы

#### FileService

- Парсинг .map файлов
- Валидация формата (480 строк)
- Извлечение бензиновых и газовых карт
- Сохранение объединенных файлов

#### MapService

- Canvas рендеринг
- Координатная система
- Масштабирование
- Обработка взаимодействий

### React Context структура

```typescript
interface AppState {
  files: MapFile[];
  selectedGasolineMap: string | null;
  selectedGasMap: string | null;
  isLoading: boolean;
  error: string | null;
}

interface AppActions {
  loadFiles: (files: File[]) => Promise<void>;
  toggleFileVisibility: (fileId: string) => void;
  toggleMapVisibility: (fileId: string, mapType: 'gasoline' | 'gas') => void;
  selectMap: (fileId: string, mapType: 'gasoline' | 'gas') => void;
  saveMergedMap: (filename: string) => Promise<void>;
}
```

## Критерии готовности

### Этап 1 готов, когда:

- [x] Проект запускается без ошибок
- [x] Tailwind CSS работает
- [x] ESLint и Prettier настроены
- [x] Базовая структура создана

### Этап 2 готов, когда:

- [x] Context создан и работает
- [x] Типы определены
- [x] Базовые сервисы созданы
- [x] IPC коммуникация настроена

### Этап 3 готов, когда:

- [x] Все UI компоненты созданы
- [x] Drag & Drop работает
- [x] Canvas отображает тестовые данные
- [x] Управление видимостью работает

### Этап 4 готов, когда:

- [ ] .map файлы парсятся корректно
- [ ] Валидация работает
- [ ] Объединение карт работает
- [ ] Сохранение файлов работает

### Этап 5 готов, когда:

- [ ] Все функции интегрированы
- [ ] Тестирование с реальными файлами пройдено
- [ ] Ошибки обрабатываются корректно
- [ ] Производительность соответствует требованиям

### Этап 6 готов, когда:

- [ ] Приложение собирается для всех платформ
- [ ] Инсталляторы созданы
- [ ] Финальное тестирование пройдено

## Временные рамки

- **Общее время:** 11-16 дней
- **Минимальная версия (MVP):** 8-10 дней
- **Полная версия:** 11-16 дней

## Риски и митигация

1. **Сложность парсинга .map файлов** - создать детальные тесты с реальными файлами
2. **Производительность Canvas** - оптимизировать рендеринг, использовать requestAnimationFrame
3. **Кроссплатформенность** - тестировать на всех целевых платформах
4. **Размер файлов** - добавить прогресс-бары для больших файлов

## Дополнительные возможности (будущие версии)

- Предварительный просмотр объединенной карты
- Настройки цветов и прозрачности
- Редактирование топливных точек
- Сравнение карт
- Пакетная обработка файлов
